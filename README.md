# F2 Выпускной проект 
Веб-сайт для внутренних опросов.

В проекте изпользуются: фреймворк Django и база данных PostgreSQL. Так же местами применяю javascript. 
Для вёрстки и визуализации использовал Material Design for Bootstrap 4.
Проект развёрнут на виртуальном сервере на хостинге и доступен по адресу: http://178.250.158.82/

В проекте доступно три типа пользователей:
1. обычные пользователи - сами регистрируются на сайте, проходят опросы и могут смотреть только свою статистику
2. staff - права пользователя устанавливает superuser, а так же добавляет в группу пользователей "персонал", эти пользователи так же могут проходить опросы, могут создавать вопросы и опросы, а так же просмтаривать статистику по всем пользователям
3. superuser - пользователь с максимальными правами, который имеет весь функционал, а так же даёт права пользователям staff

Для проверки проекта созданы следующие пользователи:
- admin с паролем 12345
- staff с паролем 12345

Сайт имеет изменяемое наполнение в зависимости от типа пользователя:
1. обычные пользователи имеют доступ к следующим страницам:
    - http://178.250.158.82/ - главная страница с кратким описанием сайта
    - http://178.250.158.82/signup/ - страница регистрации нового пользователя
    - http://178.250.158.82/login/ - страница для входа пользователя
    - http://178.250.158.82/logout/ - ссылка для выхода пользователя
    - http://178.250.158.82/polls-list/all/ - страница со всеми опросами, которая делится на подстраницы:
        - http://178.250.158.82/polls-list/available/ - страница с доступными опросами
        - http://178.250.158.82/polls-list/checked/ - страница с пройденными опросами
        - http://178.250.158.82/polls-list/not-available/ - страница с недоступными опросами
    - http://178.250.158.82/poll/<id опроса>/<id для скроллинга>/ - страница с вопросами в опросе
    - http://178.250.158.82/answers/<id опроса>/<id вопроса в опросе>/<id ответа>/?<тип input'ов>=<id ответов> - url передающий информацию о выбранных ответе/ответах
    - http://178.250.158.82/statistics/ - страница со статистикой пользователя и рейтингом пользователей
2. у пользователей staff добавляются следующие варианты:
    - http://178.250.158.82/statistics/?user_choice=<имя пользователя> - помимо своей статистики можно посмотреть полную статистику по любому пользователю
    - http://178.250.158.82/admin/ - админка сайта, в которой можно создавать и редактировать вопросы и опросы
3. у superuser добавляется ещё опция
    - http://178.250.158.82/admin/ - можно создавать, редактировать и удалять пользователей, назначать персонал и давать им права персонала

Работа с сайтом.
1. Личный кабинет составителя опросов реализован в django-admin. Интерфейс переработан таким образом, что можно сразу создавать опрос и внутри него выбирать вопросы или создавать новые с созданием ответов в них.
2. Вопросы могут быть двух вариантов: выбор одного ответа из четырёх вариантов и выбор нескольких ответов из четырёх вариантов. Так же можно добавлять картинку к вопросу.
3. Вопросы можно объединять в разные опросы. Один и тот же вопрос может быть добавлен в несколько опросов.
4. Для каждого вопроса внутри опроса можно задавать "вес", таким образом ответы на один и тот же вопрос в разных опросах могут давать разное количество баллов.
5. У каждого опроса есть дата публикации, до наступления которой он является недоступным ни для просмотра, ни для прохождения. Так же опросы поделены на доступные (которые ещё не пройдены и дата публикации уже наступила) и на пройденные, таким образом можно отфильтровать опросы по нужному типу.
6. У каждого пользователя на странице с опросами отображается информация о прохождении опросов и о набранных баллах, если опрос пройден полностью. Внутри каждого опроса видно на какие вопросы уже дан ответ и какие ответы были выбраны, а так же количество баллов за каждый вопрос.
7. На странице статистики пользователь может посмотреть сколько опросов пройдено, доступно или недоступно; сколько баллов он набрал за каждый опрос и сравнение с лучшими и худшими результатами других пользователей; общий рейтинг прохождения опросов с таблицей результатов; а так же подробная информация о том, какие ответы были даны на вопросы во всех пройденных опросах. Пользователи staff и superuser помимо просмотра своих данных имеют возможность просмотреть статистику по любому пользователю.

Установка и запуск (все действия через коммандную строку на Linux):
- скачать проект с GitHub: https://github.com/ZGuzhov/finalproject
- перейти в папку с проектом
- создать виртуальное окружение: $ python -m venv env
- применить виртуальное окружение: source env/bin/activate
- установить зависимости: pip install -r requirements.txt 
- скопировать статические файлы в рабочую папку: python manage.py collectstatic
- установить и настроить PostgreSQL:
    - установка PostgreSQL: sudo apt install postgresql postgresql-contrib
    - войти в консоль postgres: sudo -u postgres psql
    - создать базу данных и пользователя:
        - CREATE DATABASE fp_db;
        - CREATE USER admin WITH PASSWORD '912873';
    - дать все разрешения пользователю admin для взаимодействия с базой fp_db: GRANT ALL PRIVILEGES ON DATABASE fp_db TO admin;
    - примечание: в моём случае база данных использует порт 5433, так как 5432 был занят другой базой, поэтому установите нужный порт в файле settings.py
- выполнить миграции:
    - python manage.py makemigrations
    - python manage.py migrate
- создать суперпользователя: python manage.py createsuperuser
- запустить сервер: python manage.py runserver
- если сайт должен быть доступен в интернете, то необходимо установить и настроить Nginx:
    - установка: sudo apt install nginx
    - в папки /etc/nginx/sites-available/ и /etc/nginx/sites-enabled/ необходимо поместить файл настроек:
        
            server {
                listen 80;
                server_name <ip адрес вашего сервера или url>;

                location / {
                    proxy_pass http://<ip адрес вашего сервера>:8000;
                }

                location /static/ {
                    root /<путь до проекта>/finalproject;
                }

                location /media/ {
                    root /<путь до проекта>/finalproject;
                }
            }
    
    - для применения новых настроек: sudo nginx -s reload
    - для перезапуска nginx: sudo service nginx restart
